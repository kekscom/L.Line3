(function(w){function I(a){for(var b=t+n,c=q+p,d=0,l=a.length;d<l;d++)if(a[d].x>n&&a[d].x<b&&a[d].y>p&&a[d].y<c)return!0;return!1}function D(a){x=J+a.x;y=q+a.y;h.render(!0)}function K(a){t=a.width;q=a.height;x=J=t/2<<0;y=q;h.setSize(t,q)}function M(a){r=a;E=R<<r;u=N(0.95,r-v);F=""+z.alpha(u);O=6/N(2,r-v)}var g=Math,S=g.log,T=g.tan,U=g.min,V=g.max,N=g.pow,g=/iP(ad|hone|od)/g.test(navigator.userAgent),e=!!~navigator.userAgent.indexOf("Trident"),W=!w.requestAnimationFrame||g||e?function(a){a()}:w.requestAnimationFrame,
G=function(a){function b(a,b,c){0>c&&(c+=1);1<c&&(c-=1);return c<1/6?a+6*(b-a)*c:0.5>c?b:c<2/3?a+(b-a)*(2/3-c)*6:a}var c={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",grey:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#ffa500",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00"},d=function(a,b,c,d){this.H=a;this.S=b;this.L=c;this.A=d};d.parse=function(a){var b=0,d=0,f=0,
m=1,k;a=(""+a).toLowerCase();a=c[a]||a;if(k=a.match(/^#(\w{2})(\w{2})(\w{2})$/))b=parseInt(k[1],16),d=parseInt(k[2],16),f=parseInt(k[3],16);else if(k=a.match(/rgba?\((\d+)\D+(\d+)\D+(\d+)(\D+([\d.]+))?\)/))b=parseInt(k[1],10),d=parseInt(k[2],10),f=parseInt(k[3],10),m=k[4]?parseFloat(k[5]):1;else return;return this.fromRGBA(b,d,f,m)};d.fromRGBA=function(a,b,c,f){"object"===typeof a?(b=a.g/255,c=a.b/255,f=a.a,a=a.r/255):(a/=255,b/=255,c/=255);var m=Math.max(a,b,c),k=Math.min(a,b,c),e,h=(m+k)/2,g=m-
k;if(g){k=0.5<h?g/(2-m-k):g/(m+k);switch(m){case a:e=(b-c)/g+(b<c?6:0);break;case b:e=(c-a)/g+2;break;case c:e=(a-b)/g+4}e*=60}else e=k=0;return new d(e,k,h,f)};d.prototype={toRGBA:function(){var a=Math.min(360,Math.max(0,this.H)),c=Math.min(1,Math.max(0,this.S)),d=Math.min(1,Math.max(0,this.L)),f=Math.min(1,Math.max(0,this.A)),e;if(0===c)a=e=c=d;else{var k=0.5>d?d*(1+c):d+c-d*c,d=2*d-k,a=a/360,c=b(d,k,a+1/3);e=b(d,k,a);a=b(d,k,a-1/3)}return{r:Math.round(255*c),g:Math.round(255*e),b:Math.round(255*
a),a:f}},toString:function(){var a=this.toRGBA();return 1===a.a?"#"+(16777216+(a.r<<16)+(a.g<<8)+a.b).toString(16).slice(1,7):"rgba("+[a.r,a.g,a.b,a.a.toFixed(2)].join()+")"},hue:function(a){return new d(this.H*a,this.S,this.L,this.A)},saturation:function(a){return new d(this.H,this.S*a,this.L,this.A)},lightness:function(a){return new d(this.H,this.S,this.L*a,this.A)},alpha:function(a){return new d(this.H,this.S,this.L,this.A*a)}};return d}(this),H=Math.PI,X=H/2,Y=H/4,R=256,r,E,v=15,t=0,q=0,J=0,n=
0,p=0,z=G.parse("rgba(200, 190, 180)"),F=""+z,u=1,O=1,x,y,A,Z=function(){return{read:function(a){if(!a||"FeatureCollection"!==a.type)return[];a=a.features;var b,c,d=[],l,e;b=0;for(c=a.length;b<c;b++)if(l=a[b],"Feature"===l.type&&!1!==P(l)){e=l.properties;e.coordinates=l.geometry.coordinates;if(l.id||l.properties.id)e.id=l.id||l.properties.id;d.push(e)}return d}}}(),s={items:[],getPixelCoordinates:function(a){for(var b=[],c,d=0,l=a.length;d<l;d++){c=a[d][0];var e=U(1,V(0,0.5-S(T(Y+X*a[d][1]/180))/
H/2));c={x:(c/360+0.5)*E<<0,y:e*E<<0};c.z=a[d][2]/O;b[d]=c}return b},resetItems:function(){this.items=[]},addRenderItems:function(a){for(var b,c=Z.read(a),d=0,e=c.length;d<e;d++)a=c[d],(b=this.scale(a))&&this.items.push(b);h.render()},scale:function(a){var b={};a.id&&(b.id=a.id);b.coordinates=this.getPixelCoordinates(a.coordinates);if(a=G.parse(a.color||F))a=a.alpha(u),b.altColor=""+a.lightness(0.7),b.color=""+a;return b},set:function(a){this.resetItems();this._staticData=a;this.addRenderItems(this._staticData)},
update:function(){this.resetItems();r<v||this.addRenderItems(this._staticData)}},Q={draw:function(a,b){this.extrude(a,b)},extrude:function(a,b){for(var c=b.coordinates,d={x:0,y:0,z:0},e={x:0,y:0,z:0},g,h,f=0,m=c.length-1;f<m;f++)d.x=c[f].x-n,d.y=c[f].y-p,d.z=c[f].z,e.x=c[f+1].x-n,e.y=c[f+1].y-p,e.z=c[f+1].z,g=B.project(d,450/(450-d.z)),h=B.project(e,450/(450-e.z)),a.fillStyle=d.x<e.x&&d.y<e.y||d.x>e.x&&d.y>e.y?b.altColor:b.color,a.beginPath(),this.polygon(a,[e,d,g,h]),a.closePath(),a.stroke(),a.fill()},
polygon:function(a,b){a.moveTo(b[0].x,b[0].y);for(var c=1;c<b.length;c++)a.lineTo(b[c].x,b[c].y)},shadow:function(a,b){for(var c=b.coordinates,d={x:0,y:0},e={x:0,y:0},g,h,f=0,m=c.length-1;f<m;f++)d.x=c[f].x-n,d.y=c[f].y-p,d.z=c[f].z,e.x=c[f+1].x-n,e.y=c[f+1].y-p,e.z=c[f+1].z,g=C.project(d,d.z),h=C.project(e,e.z),a.beginPath(),a.moveTo(d.x,d.y),a.lineTo(g.x,g.y),a.lineTo(h.x,h.y),a.lineTo(e.x,e.y),a.closePath(),a.fill()}},B={project:function(a,b){return{x:(a.x-x)*b+x<<0,y:(a.y-y)*b+y<<0}},render:function(){var a=
this.context;a.clearRect(0,0,t,q);if(!(r<v||A))for(var b=s.items,c=0,d=b.length;c<d;c++)I(b[c].coordinates)&&Q.draw(a,b[c])}},C={enabled:!0,direction:{x:2,y:2},project:function(a,b){return{x:a.x+this.direction.x*b,y:a.y+this.direction.y*b}},render:function(){var a=this.context;a.clearRect(0,0,t,q);if(!(r<v||A)){var b,c,d=s.items;a.fillStyle="#000000";a.canvas.style.opacity=0.4/(2*u);b=0;for(c=d.length;b<c;b++)I(d[b].coordinates)&&Q.shadow(a,d[b])}}},h={container:document.createElement("DIV"),items:[],
init:function(){this.container.style.pointerEvents="none";this.container.style.position="absolute";this.container.style.left=0;this.container.style.top=0;C.context=this.createContext(this.container);B.context=this.createContext(this.container);this.createContext(this.container)},render:function(a){W(function(){a||C.render();B.render()})},createContext:function(a){var b=document.createElement("CANVAS");b.style.webkitTransform="translate3d(0,0,0)";b.style.imageRendering="optimizeSpeed";b.style.position=
"absolute";b.style.left=0;b.style.top=0;var c=b.getContext("2d");c.lineCap="round";c.lineJoin="round";c.lineWidth=1;c.mozImageSmoothingEnabled=!1;c.webkitImageSmoothingEnabled=!1;this.items.push(b);a&&a.appendChild(b);return c},appendTo:function(a){a.appendChild(this.container)},remove:function(){this.container.parentNode.removeChild(this.container)},setSize:function(a,b){for(var c=0,d=this.items.length;c<d;c++)this.items[c].width=a,this.items[c].height=b},setPosition:function(a,b){this.container.style.left=
a+"px";this.container.style.top=b+"px"}};h.init();g=function(a){this.offset={x:0,y:0};s.set(a)};e=g.prototype=L.Layer?new L.Layer:{};e.onAdd=function(a){this.map=a;h.appendTo(a._panes.overlayPane);var b=this.getOffset(),c=a.getPixelOrigin();K({width:a._size.x,height:a._size.y});var d=c.y-b.y;n=c.x-b.x;p=d;M(a._zoom);h.setPosition(-b.x,-b.y);a.on({move:this.onMove,moveend:this.onMoveEnd,zoomstart:this.onZoomStart,zoomend:this.onZoomEnd,resize:this.onResize,viewreset:this.onViewReset,click:this.onClick},
this);if(a.options.zoomAnimation)a.on("zoomanim",this.onZoom,this);s.update()};e.onRemove=function(){var a=this.map;a.off({move:this.onMove,moveend:this.onMoveEnd,zoomstart:this.onZoomStart,zoomend:this.onZoomEnd,resize:this.onResize,viewreset:this.onViewReset,click:this.onClick},this);a.options.zoomAnimation&&a.off("zoomanim",this.onZoom,this);h.remove()};e.onMove=function(a){a=this.getOffset();D({x:this.offset.x-a.x,y:this.offset.y-a.y})};e.onMoveEnd=function(a){if(this.noMoveEnd)this.noMoveEnd=
!1;else{var b=this.map;a=this.getOffset();var c=b.getPixelOrigin();this.offset=a;h.setPosition(-a.x,-a.y);D({x:0,y:0});K({width:b._size.x,height:b._size.y});b=c.y-a.y;n=c.x-a.x;p=b;h.render();s.update()}};e.onZoomStart=function(a){A=!0;h.render()};e.onZoom=function(a){};e.onZoomEnd=function(a){a=this.map;var b=this.getOffset(),c=a.getPixelOrigin(),d=c.y-b.y;n=c.x-b.x;p=d;a=a._zoom;A=!1;M(a);s.update();h.render();this.noMoveEnd=!0};e.onResize=function(){};e.onViewReset=function(){var a=this.getOffset();
this.offset=a;h.setPosition(-a.x,-a.y);D({x:0,y:0})};e.getOffset=function(){return L.DomUtil.getPosition(this.map._mapPane)};e.style=function(a){a=a||{};if(a=a.color)z=G.parse(a).alpha(u),F=""+z;h.render();return this};e.set=function(a){s.set(a);return this};var P=function(){};e.each=function(a){P=function(b){return a(b)};return this};g.VERSION="0.1.0";w.L&&(w.L.Line3=g)})(this);
